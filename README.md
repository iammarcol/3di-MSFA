# 3di-MSFA

This updated version of the MSFA.R script enables the generation of energetic frustration profiles using 3Di labels instead of the original amino acid labels. The script relies on auxiliary files located in the /AuxFiles directory, particularly the DF_Colores file. Before executing this script, ensure that all necessary FrustraEvo outputs have been generated. You can calculate frustration and obtain evolutionary profiles for your protein family using the original FrustraEvo server, developed by Parra & Freiberger et al. (bioRxiv, 2023). Access the server at: [FrustraEvo](https://frustraevo.qb.fcen.uba.ar) or configure the software by following the instructions at [FrustraEvo Github](https://github.com/proteinphysiologylab/FrustraEvo).

Originally, Foldseek takes as the input a single PDB file and converts its sequence to 3di. (I installed foldseek as a precompiled binary, locally - so this is a requirement in order to execute the script. You can find the installation process on the original foldseek depository at https://github.com/steineggerlab/foldseek) 

Bash script was created foldseek.sh to include **multiple PDB** files and MSA as input, so that this is the same input that FrustraEvo requires. This is executed with:
```
foldseek.sh PDB_DIRECTORY MSA_FILE
```
Executing this script will generate several files:

1) 3di_seq directory and descriptors directory - these 2 are original output of foldseek command where 3di_seq contains single fasta 3di files and descriptors directory contains .dump and .dump.dbtype files (not important for this). They will be generated inside the $PDB_DIRECTORY.

2) 3di_multiplefasta.fasta file - multifasta file of all 3di sequences generated inside the 3di_seq directory. This file is used to modify the input $MSA_FILE (to replace amino acids with 3di from this file)

3) MSA_3di.fasta file - aa_msa_to_3di.py creates this file which is a MSA of 3di with gaps at the same places as in the original MSA.

4) MSA_3di_reference.fasta - mod_mfasta.py creates this file which is a MSA adjusted based on the reference sequence (MSA where reference has no gaps and other sequences are modified correspondingly) and this file is used to create modified DF_Colores (DF_Colores_3di and DF_Colores_MODIF) which is the input of MSFA.R




```
Rscript MSFA.R --dir FRUSTRAEVO_DIRECTORY --jobid JOBID
```
Executing this script creates 4 files:

1) /AuxFiles/DF_Colores_3di.csv - DF_Colores type file with 3di
2) /AuxFiles/DF_Colores_MODIF.csv - merged DF_colores and DF_Colores_3di. Input file for MSFA.R
3) /OutPutFiles/MSFA_{jobid}.png - the original MSFA generated by the script.

---> 4) /OutPutFiles/**MSFA_3di_{jobid}.png** - same as MSFA but with 3di labels instead of amino acids.

For this to work all scripts should be put in the /pdb-/FrustraEvo-jobid/ directory after getting the FrustraEvo output. 
Find the example.zip file with generated outputs. 




References:

van Kempen M, Kim S, Tumescheit C, Mirdita M, Lee J, Gilchrist C, Söding J, and Steinegger M. Fast and accurate protein structure search with Foldseek. Nature Biotechnology, doi:10.1038/s41587-023-01773-0 (2023)

Barrio-Hernandez I, Yeo J, Jänes J, Mirdita M, Gilchrist LMC, Wein T, Varadi M, Velankar S, Beltrao P and Steinegger M. Clustering predicted structures at the scale of the known protein universe. Nature, doi:10.1038/s41586-023-06510-w (2023)

Freiberger, M.I., Ruiz-Serra, V., Pontes, C. et al. Local energetic frustration conservation in protein families and superfamilies. Nat Commun 14, 8379 (2023). https://doi.org/10.1038/s41467-023-43801-2

